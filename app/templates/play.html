{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    {% if not limit_reached %}
    <div class="row align-items-center justify-content-center" style="min-height: 70vh;">

        <div class="col-lg-6">
            <div id="game-board" class="mb-4">
                {% for guess_row in history %}
                <div class="game-row">
                    {% for letter_info in guess_row %}
                    <div class="letter-box {{ letter_info.color }}">{{ letter_info.letter }}</div>
                    {% endfor %}
                </div>
                {% endfor %}

                {% set remaining_rows = 5 - history|length %}
                {% if game_over %}{% set remaining_rows = 0 %}{% endif %}
                {% if remaining_rows > 0 %}
                {% for i in range(remaining_rows) %}
                <div class="game-row">
                    <div class="letter-box"></div>
                    <div class="letter-box"></div>
                    <div class="letter-box"></div>
                    <div class="letter-box"></div>
                    <div class="letter-box"></div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>

        <div class="col-lg-4 text-center">
            <div class="game-controls glass-card p-5">
                <h2 class="mb-3">Guess the Word!</h2>

                {% if not game_over %}
                <p class="lead mb-4">You have {{ 5 - attempts }} guesses remaining.</p>
                <form method="POST" class="game-form">
                    <input type="text" name="guess" class="form-control form-control-lg text-center mb-3"
                        style="text-transform: uppercase;" maxlength="5" minlength="5" pattern="[A-Za-z]{5}"
                        title="Enter a 5-letter word" required autofocus>
                    <button type="submit" class="btn btn-glass-primary w-100">Guess</button>
                </form>
                {% else %}
                <a href="{{ url_for('main.play') }}" class="btn btn-light mt-2">Play Again</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<div class="modal fade modal-success" id="winModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="winModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="winModalLabel"> CONGRATULATIONS!!!</h5>
            </div>
            <div class="modal-body text-center">
                <p class="lead">{{ message }}</p>
            </div>
            <div class="modal-footer">
                <a href="{{ url_for('main.leaderboard') }}" class="btn btn-outline-light">View Leaderboard</a>
                <a href="{{ url_for('main.play') }}" class="btn btn-success-glass">OK (Play Again)</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-lose" id="loseModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="loseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loseModalLabel">GAME OVER</h5>
            </div>
            <div class="modal-body text-center">
                <p class="lead">{{ message }}</p>
                <p>The word was: <strong>{{ secret_word }}</strong></p>
            </div>
            <div class="modal-footer">
                <a href="{{ url_for('main.play') }}" class="btn btn-light w-100">OK</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade modal-limit" id="dailyLimitModal" data-bs-backdrop="static" data-bs-keyboard="false"
    tabindex="-1" aria-labelledby="dailyLimitModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dailyLimitModalLabel">Daily Limit Reached</h5>
            </div>
            <div class="modal-body text-center">
                <p class="lead">You have already played your 3 games for today. Please come back tomorrow!</p>
            </div>
            <div class="modal-footer">
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-light">Dashboard</a>
                <a href="{{ url_for('main.leaderboard') }}" class="btn btn-warning-glass">Leaderboard</a>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const isWin = '{{ is_win }}' === 'True';
        const isGameOver = '{{ game_over }}' === 'True';
        const isLimitReached = '{{ limit_reached }}' === 'True';

        if (isLimitReached) {
            const limitModal = new bootstrap.Modal(document.getElementById('dailyLimitModal'));
            limitModal.show();
        } else if (isWin) {
            const winModal = new bootstrap.Modal(document.getElementById('winModal'));
            winModal.show();
            confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
        } else if (isGameOver) {
            const loseModal = new bootstrap.Modal(document.getElementById('loseModal'));
            loseModal.show();
        }
    });
</script>
{% endblock %}